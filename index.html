<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Insights Creator - Google Sheets Sync</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // ============================================================================
        // CONFIGURATION - YOUR CREDENTIALS
        // ============================================================================
        const CONFIG = {
            CLIENT_ID: '493461531003-nkk8oag1u51j9mtm2k76a5c8a5l9g5q0.apps.googleusercontent.com',
            SPREADSHEET_ID: '1ikVeCPQiYA-SWgaHuViai9qv6BeiJAFODPpkeg5jbfI',
            SHEET_NAME: 'Insights Data',
            SCOPES: 'https://www.googleapis.com/auth/spreadsheets'
        };

        // ============================================================================
        // TAXONOMY DATA
        // ============================================================================
        const TAXONOMY = {
            "Horizon Scanning": {
                "Big Tech & Ecosystem Plays": [
                    "Platform updates and releases",
                    "Strategic direction and investment",
                    "Sector-tech signals",
                    "Tech startups competing with legacy clients"
                ],
                "Consumer Adoption Trends": [
                    "How is the consumer adoption of AI changing behaviours and CX demands?",
                    "LLM / agentic uses",
                    "Sector trends",
                    "Consumer trust"
                ],
                "Geopolitical Developments": [
                    "Macroeconomic trends",
                    "Government investments",
                    "East/West AI race",
                    "Energy and compute"
                ],
                "Investment Patterns": [
                    "Whole market - investment in AI as a whole",
                    "Within market - where AI investments are heading",
                    "Emerging market - growth areas for AI VC investment"
                ],
                "Regulatory Changes": [
                    "Global",
                    "EU",
                    "UK"
                ]
            },
            "Brand Use Cases": {
                "Alliances & Collaborations": [
                    "Competitors",
                    "Affinity brands"
                ],
                "ROI Models": [
                    "How brands are measuring success",
                    "Emerging tech metrics"
                ],
                "Emerging Operating Models": [
                    "Organisational design (e.g. dedicated mission teams; etc)",
                    "People skills (building AI-fluency)",
                    "Process design (e.g. KPI-driven workflow; holistic operating model redesign)",
                    "Developer trends (e.g. emerging developer KPI's)"
                ],
                "Market Communications": [
                    "Competitors",
                    "Adjacent brands",
                    "Broader market"
                ]
            },
            "Technology Digest": {
                "Emerging Tech Vendors": [
                    "Tech safaris"
                ],
                "Incumbent Vendor Innovations": [
                    "New features, functions and applications from existing vendors"
                ]
            }
        };

        const REFERENCE_DATA = {
            relevanceTags: ["Travel", "Loyalty", "Adjacent", "Broader"],
            signalStrength: ["Weak", "Medium", "Strong"],
            timeHorizon: ["Immediate (0-3 months)", "Near-term (3-12 months)", "Mid-term (12-24 months)", "Long-term (24+ months)"],
            impactPotential: ["Low", "Medium", "High", "Transformational"],
            recommendedAction: ["Monitor", "Investigate", "Pilot", "Implement"],
            sourceCredibility: ["High", "Medium", "Low"],
            confidenceLevel: ["High", "Medium", "Low"],
            status: ["Draft", "Review", "Published", "Archived"]
        };

        // ============================================================================
        // GOOGLE SHEETS API CLASS
        // ============================================================================
        
        class GoogleSheetsAPI {
            constructor() {
                this.accessToken = null;
                this.tokenClient = null;
            }

            // Initialize Google Identity Services
            initGoogleAuth(onAuthSuccess) {
                try {
                    this.tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: CONFIG.CLIENT_ID,
                        scope: CONFIG.SCOPES,
                        callback: (response) => {
                            if (response.access_token) {
                                this.accessToken = response.access_token;
                                localStorage.setItem('google_access_token', response.access_token);
                                onAuthSuccess();
                            }
                        },
                    });
                } catch (error) {
                    console.error('Error initializing Google Auth:', error);
                }
            }

            // Request access token
            async requestAccessToken() {
                return new Promise((resolve, reject) => {
                    if (!this.tokenClient) {
                        reject(new Error('Token client not initialized'));
                        return;
                    }
                    this.tokenClient.callback = (response) => {
                        if (response.access_token) {
                            this.accessToken = response.access_token;
                            localStorage.setItem('google_access_token', response.access_token);
                            resolve();
                        } else {
                            reject(new Error('Failed to get access token'));
                        }
                    };
                    this.tokenClient.requestAccessToken();
                });
            }

            // Check if authenticated
            isAuthenticated() {
                this.accessToken = this.accessToken || localStorage.getItem('google_access_token');
                return !!this.accessToken;
            }

            // Sign out
            signOut() {
                this.accessToken = null;
                localStorage.removeItem('google_access_token');
            }

            // Read all insights from Google Sheets
            async readInsights() {
                if (!this.isAuthenticated()) {
                    throw new Error('Not authenticated');
                }

                const range = `${CONFIG.SHEET_NAME}!A2:S`;
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SPREADSHEET_ID}/values/${range}`;

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${this.accessToken}`
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Failed to read sheets: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                const rows = data.values || [];

                // Convert rows to insight objects
                return rows.map((row, index) => ({
                    id: index + 2, // Row number (starting from 2 because row 1 is headers)
                    date: row[0] || '',
                    sourceName: row[1] || '',
                    sourceUrl: row[2] || '',
                    category: row[3] || '',
                    section: row[4] || '',
                    subsection: row[5] || '',
                    title: row[6] || '',
                    summary: row[7] || '',
                    creatorAnalysis: row[8] || '',
                    relevanceTags: row[9] ? row[9].split(', ') : [],
                    signalStrength: row[10] || '',
                    timeHorizon: row[11] || '',
                    impactPotential: row[12] || '',
                    recommendedAction: row[13] || '',
                    relatedEntities: row[14] || '',
                    sourceCredibility: row[15] || '',
                    confidenceLevel: row[16] || '',
                    creatorNotes: row[17] || '',
                    status: row[18] || 'Draft'
                }));
            }

            // Append new insight to Google Sheets
            async appendInsight(insight) {
                if (!this.isAuthenticated()) {
                    throw new Error('Not authenticated');
                }

                const range = `${CONFIG.SHEET_NAME}!A:S`;
                const values = [[
                    insight.date,
                    insight.sourceName,
                    insight.sourceUrl,
                    insight.category,
                    insight.section,
                    insight.subsection,
                    insight.title,
                    insight.summary,
                    insight.creatorAnalysis,
                    insight.relevanceTags.join(', '),
                    insight.signalStrength,
                    insight.timeHorizon,
                    insight.impactPotential,
                    insight.recommendedAction,
                    insight.relatedEntities,
                    insight.sourceCredibility,
                    insight.confidenceLevel,
                    insight.creatorNotes,
                    insight.status
                ]];

                const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SPREADSHEET_ID}/values/${range}:append?valueInputOption=USER_ENTERED`;

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${this.accessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ values })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Failed to append insight: ${response.status} - ${errorText}`);
                }

                return await response.json();
            }

            // Delete insight from Google Sheets
            async deleteInsight(rowNumber) {
                if (!this.isAuthenticated()) {
                    throw new Error('Not authenticated');
                }

                // Get sheet ID first
                const sheetUrl = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SPREADSHEET_ID}`;
                const sheetResponse = await fetch(sheetUrl, {
                    headers: {
                        'Authorization': `Bearer ${this.accessToken}`
                    }
                });

                if (!sheetResponse.ok) {
                    throw new Error('Failed to get sheet info');
                }

                const sheetData = await sheetResponse.json();
                const sheet = sheetData.sheets.find(s => s.properties.title === CONFIG.SHEET_NAME);
                const sheetId = sheet ? sheet.properties.sheetId : 0;

                const requests = [{
                    deleteDimension: {
                        range: {
                            sheetId: sheetId,
                            dimension: 'ROWS',
                            startIndex: rowNumber - 1,
                            endIndex: rowNumber
                        }
                    }
                }];

                const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SPREADSHEET_ID}:batchUpdate`;

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${this.accessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ requests })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Failed to delete insight: ${response.status} - ${errorText}`);
                }

                return await response.json();
            }
        }

        // ============================================================================
        // MAIN COMPONENT
        // ============================================================================

        function AIInsightsCreator() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [isLoading, setIsLoading] = useState(false);
            const [insights, setInsights] = useState([]);
            const [sheetsAPI] = useState(() => new GoogleSheetsAPI());
            
            const [currentInsight, setCurrentInsight] = useState({
                date: new Date().toISOString().split('T')[0],
                sourceName: '',
                sourceUrl: '',
                category: '',
                section: '',
                subsection: '',
                title: '',
                summary: '',
                creatorAnalysis: '',
                relevanceTags: [],
                signalStrength: '',
                timeHorizon: '',
                impactPotential: '',
                recommendedAction: '',
                relatedEntities: '',
                sourceCredibility: '',
                confidenceLevel: '',
                creatorNotes: '',
                status: 'Draft'
            });
            
            const [viewMode, setViewMode] = useState('form');
            const [showPreview, setShowPreview] = useState(false);
            const [statusMessage, setStatusMessage] = useState('');

            // Initialize Google Auth on mount
            useEffect(() => {
                const checkAuth = () => {
                    if (sheetsAPI.isAuthenticated()) {
                        setIsAuthenticated(true);
                        loadInsights();
                    }
                };

                // Wait for Google API to load
                const initTimer = setInterval(() => {
                    if (window.google) {
                        clearInterval(initTimer);
                        sheetsAPI.initGoogleAuth(checkAuth);
                        checkAuth();
                    }
                }, 100);

                return () => clearInterval(initTimer);
            }, []);

            // Load insights from Google Sheets
            const loadInsights = async () => {
                setIsLoading(true);
                setStatusMessage('Loading insights from Google Sheets...');
                try {
                    const data = await sheetsAPI.readInsights();
                    setInsights(data);
                    setStatusMessage(`✓ Loaded ${data.length} insights from Google Sheets`);
                    setTimeout(() => setStatusMessage(''), 3000);
                } catch (error) {
                    console.error('Error loading insights:', error);
                    setStatusMessage(`Error: ${error.message}`);
                    if (error.message.includes('401') || error.message.includes('403')) {
                        setIsAuthenticated(false);
                        sheetsAPI.signOut();
                    }
                } finally {
                    setIsLoading(false);
                }
            };

            // Handle Google Sign-In
            const handleSignIn = async () => {
                setIsLoading(true);
                setStatusMessage('Connecting to Google...');
                try {
                    await sheetsAPI.requestAccessToken();
                    setIsAuthenticated(true);
                    await loadInsights();
                } catch (error) {
                    console.error('Sign-in error:', error);
                    setStatusMessage(`Sign-in failed: ${error.message}`);
                    setIsLoading(false);
                }
            };

            // Handle Sign Out
            const handleSignOut = () => {
                sheetsAPI.signOut();
                setIsAuthenticated(false);
                setInsights([]);
                setStatusMessage('Signed out successfully');
            };

            const availableSections = currentInsight.category 
                ? Object.keys(TAXONOMY[currentInsight.category] || {})
                : [];

            const availableSubsections = (currentInsight.category && currentInsight.section)
                ? (TAXONOMY[currentInsight.category]?.[currentInsight.section] || [])
                : [];

            const handleChange = (field, value) => {
                setCurrentInsight(prev => {
                    const updated = { ...prev, [field]: value };
                    
                    if (field === 'category') {
                        updated.section = '';
                        updated.subsection = '';
                    }
                    
                    if (field === 'section') {
                        updated.subsection = '';
                    }
                    
                    return updated;
                });
            };

            const toggleRelevanceTag = (tag) => {
                setCurrentInsight(prev => ({
                    ...prev,
                    relevanceTags: prev.relevanceTags.includes(tag)
                        ? prev.relevanceTags.filter(t => t !== tag)
                        : [...prev.relevanceTags, tag]
                }));
            };

            const handleSave = async () => {
                if (!currentInsight.category || !currentInsight.section || !currentInsight.subsection) {
                    alert('Please fill in Category, Section, and Subsection');
                    return;
                }

                if (!currentInsight.title || !currentInsight.summary) {
                    alert('Please fill in Title and Summary');
                    return;
                }

                setIsLoading(true);
                setStatusMessage('Saving to Google Sheets...');
                
                try {
                    await sheetsAPI.appendInsight(currentInsight);
                    await loadInsights();
                    
                    // Reset form
                    setCurrentInsight({
                        date: new Date().toISOString().split('T')[0],
                        sourceName: '',
                        sourceUrl: '',
                        category: '',
                        section: '',
                        subsection: '',
                        title: '',
                        summary: '',
                        creatorAnalysis: '',
                        relevanceTags: [],
                        signalStrength: '',
                        timeHorizon: '',
                        impactPotential: '',
                        recommendedAction: '',
                        relatedEntities: '',
                        sourceCredibility: '',
                        confidenceLevel: '',
                        creatorNotes: '',
                        status: 'Draft'
                    });
                    
                    setStatusMessage('✓ Insight saved to Google Sheets!');
                    setTimeout(() => setStatusMessage(''), 3000);
                } catch (error) {
                    console.error('Save error:', error);
                    alert(`Error saving: ${error.message}`);
                    setStatusMessage('');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleDelete = async (id) => {
                if (!confirm('Are you sure you want to delete this insight from Google Sheets?')) {
                    return;
                }

                setIsLoading(true);
                setStatusMessage('Deleting from Google Sheets...');
                
                try {
                    await sheetsAPI.deleteInsight(id);
                    await loadInsights();
                    setStatusMessage('✓ Insight deleted from Google Sheets');
                    setTimeout(() => setStatusMessage(''), 3000);
                } catch (error) {
                    console.error('Delete error:', error);
                    alert(`Error deleting: ${error.message}`);
                    setStatusMessage('');
                } finally {
                    setIsLoading(false);
                }
            };

            // Login Screen
            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center p-8">
                        <div className="max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center">
                            <h1 className="text-3xl font-bold text-gray-800 mb-4">AI Insights Creator</h1>
                            <p className="text-gray-600 mb-8">
                                Connect to Google Sheets to sync your insights in real-time
                            </p>
                            
                            <div className="mb-6 p-4 bg-blue-50 rounded border border-blue-200">
                                <p className="text-sm text-blue-800 text-left">
                                    <strong>✓ Permanent storage</strong> - Never lose your work<br/>
                                    <strong>✓ Real-time sync</strong> - Auto-saves every change<br/>
                                    <strong>✓ Access anywhere</strong> - Your data in Google Sheets
                                </p>
                            </div>

                            <button
                                onClick={handleSignIn}
                                disabled={isLoading}
                                className="w-full px-6 py-3 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400 font-semibold"
                            >
                                {isLoading ? 'Connecting...' : '🔐 Sign In with Google'}
                            </button>

                            {statusMessage && (
                                <p className="mt-4 text-sm text-red-600">{statusMessage}</p>
                            )}
                        </div>
                    </div>
                );
            }

            // Main Application
            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <div className="bg-blue-900 text-white p-6 shadow-lg">
                        <div className="max-w-7xl mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="text-3xl font-bold">AI Insights Creator</h1>
                                <p className="text-blue-200 mt-2">✓ Connected to Google Sheets - Auto-saving</p>
                            </div>
                            <div className="flex gap-4 items-center">
                                <button
                                    onClick={loadInsights}
                                    disabled={isLoading}
                                    className="px-4 py-2 bg-blue-700 rounded hover:bg-blue-600 disabled:bg-blue-800"
                                >
                                    {isLoading ? '⟳ Syncing...' : '↻ Refresh'}
                                </button>
                                <button
                                    onClick={handleSignOut}
                                    className="px-4 py-2 bg-red-600 rounded hover:bg-red-700"
                                >
                                    Sign Out
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Status Message */}
                    {statusMessage && (
                        <div className="bg-green-50 border-b border-green-200 px-6 py-3">
                            <p className="text-green-800 text-center max-w-7xl mx-auto">{statusMessage}</p>
                        </div>
                    )}

                    {/* Navigation */}
                    <div className="bg-white border-b">
                        <div className="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
                            <div className="flex gap-4">
                                <button
                                    onClick={() => setViewMode('form')}
                                    className={`px-4 py-2 rounded ${viewMode === 'form' ? 'bg-blue-900 text-white' : 'bg-gray-200 text-gray-700'}`}
                                >
                                    Add New Insight
                                </button>
                                <button
                                    onClick={() => setViewMode('list')}
                                    className={`px-4 py-2 rounded ${viewMode === 'list' ? 'bg-blue-900 text-white' : 'bg-gray-200 text-gray-700'}`}
                                >
                                    View All ({insights.length})
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-7xl mx-auto p-6">
                        {viewMode === 'form' ? (
                            <div className="bg-white rounded-lg shadow-lg p-8">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">Create New Insight</h2>
                                
                                {/* Source Information */}
                                <div className="mb-8">
                                    <h3 className="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Source Information</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                            <input
                                                type="date"
                                                value={currentInsight.date}
                                                onChange={(e) => handleChange('date', e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Source Name</label>
                                            <input
                                                type="text"
                                                value={currentInsight.sourceName}
                                                onChange={(e) => handleChange('sourceName', e.target.value)}
                                                placeholder="e.g., TechCrunch, OpenAI Blog"
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                    </div>
                                    <div className="mt-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Source URL</label>
                                        <input
                                            type="url"
                                            value={currentInsight.sourceUrl}
                                            onChange={(e) => handleChange('sourceUrl', e.target.value)}
                                            placeholder="https://..."
                                            className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>
                                </div>

                                {/* Taxonomy Classification */}
                                <div className="mb-8">
                                    <h3 className="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Taxonomy Classification</h3>
                                    <div className="grid grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                                            <select
                                                value={currentInsight.category}
                                                onChange={(e) => handleChange('category', e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            >
                                                <option value="">Select category...</option>
                                                {Object.keys(TAXONOMY).map(cat => (
                                                    <option key={cat} value={cat}>{cat}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Section *</label>
                                            <select
                                                value={currentInsight.section}
                                                onChange={(e) => handleChange('section', e.target.value)}
                                                disabled={!currentInsight.category}
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"
                                            >
                                                <option value="">Select section...</option>
                                                {availableSections.map(sec => (
                                                    <option key={sec} value={sec}>{sec}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Subsection *</label>
                                            <select
                                                value={currentInsight.subsection}
                                                onChange={(e) => handleChange('subsection', e.target.value)}
                                                disabled={!currentInsight.section}
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"
                                            >
                                                <option value="">Select subsection...</option>
                                                {availableSubsections.map(sub => (
                                                    <option key={sub} value={sub}>{sub}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                {/* Content */}
                                <div className="mb-8">
                                    <h3 className="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Content</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Title/Headline *</label>
                                            <input
                                                type="text"
                                                value={currentInsight.title}
                                                onChange={(e) => handleChange('title', e.target.value)}
                                                placeholder="Brief title summarizing the insight"
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Summary *</label>
                                            <textarea
                                                value={currentInsight.summary}
                                                onChange={(e) => handleChange('summary', e.target.value)}
                                                placeholder="Objective summary of the source content (100-200 words)"
                                                rows="4"
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Creator Analysis <span className="text-blue-600">(Your Value-Add)</span>
                                            </label>
                                            <textarea
                                                value={currentInsight.creatorAnalysis}
                                                onChange={(e) => handleChange('creatorAnalysis', e.target.value)}
                                                placeholder="YOUR expert perspective: Why does this matter? What should customers do? (100-300 words)"
                                                rows="5"
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Intelligence Fields */}
                                <div className="mb-8">
                                    <h3 className="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Intelligence Assessment</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Relevance Tags</label>
                                            <div className="flex gap-3">
                                                {REFERENCE_DATA.relevanceTags.map(tag => (
                                                    <button
                                                        key={tag}
                                                        type="button"
                                                        onClick={() => toggleRelevanceTag(tag)}
                                                        className={`px-4 py-2 rounded ${
                                                            currentInsight.relevanceTags.includes(tag)
                                                                ? 'bg-blue-600 text-white'
                                                                : 'bg-gray-200 text-gray-700'
                                                        }`}
                                                    >
                                                        {tag}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Signal Strength</label>
                                                <select
                                                    value={currentInsight.signalStrength}
                                                    onChange={(e) => handleChange('signalStrength', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                >
                                                    <option value="">Select...</option>
                                                    {REFERENCE_DATA.signalStrength.map(val => (
                                                        <option key={val} value={val}>{val}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Time Horizon</label>
                                                <select
                                                    value={currentInsight.timeHorizon}
                                                    onChange={(e) => handleChange('timeHorizon', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                >
                                                    <option value="">Select...</option>
                                                    {REFERENCE_DATA.timeHorizon.map(val => (
                                                        <option key={val} value={val}>{val}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Impact Potential</label>
                                                <select
                                                    value={currentInsight.impactPotential}
                                                    onChange={(e) => handleChange('impactPotential', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                >
                                                    <option value="">Select...</option>
                                                    {REFERENCE_DATA.impactPotential.map(val => (
                                                        <option key={val} value={val}>{val}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Recommended Action</label>
                                                <select
                                                    value={currentInsight.recommendedAction}
                                                    onChange={(e) => handleChange('recommendedAction', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                >
                                                    <option value="">Select...</option>
                                                    {REFERENCE_DATA.recommendedAction.map(val => (
                                                        <option key={val} value={val}>{val}</option>
                                                    ))}
                                                </select>
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Related Entities</label>
                                            <input
                                                type="text"
                                                value={currentInsight.relatedEntities}
                                                onChange={(e) => handleChange('relatedEntities', e.target.value)}
                                                placeholder="Companies, products, technologies mentioned (comma-separated)"
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Metadata */}
                                <div className="mb-8">
                                    <h3 className="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Metadata</h3>
                                    <div className="grid grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Source Credibility</label>
                                            <select
                                                value={currentInsight.sourceCredibility}
                                                onChange={(e) => handleChange('sourceCredibility', e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            >
                                                <option value="">Select...</option>
                                                {REFERENCE_DATA.sourceCredibility.map(val => (
                                                    <option key={val} value={val}>{val}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Confidence Level</label>
                                            <select
                                                value={currentInsight.confidenceLevel}
                                                onChange={(e) => handleChange('confidenceLevel', e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            >
                                                <option value="">Select...</option>
                                                {REFERENCE_DATA.confidenceLevel.map(val => (
                                                    <option key={val} value={val}>{val}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Status</label>
                                            <select
                                                value={currentInsight.status}
                                                onChange={(e) => handleChange('status', e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            >
                                                {REFERENCE_DATA.status.map(val => (
                                                    <option key={val} value={val}>{val}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    <div className="mt-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Creator Notes (Internal)</label>
                                        <textarea
                                            value={currentInsight.creatorNotes}
                                            onChange={(e) => handleChange('creatorNotes', e.target.value)}
                                            placeholder="Internal notes (not shown to customers)"
                                            rows="2"
                                            className="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>
                                </div>

                                {/* Actions */}
                                <div className="flex justify-between pt-6 border-t">
                                    <button
                                        type="button"
                                        onClick={() => setShowPreview(!showPreview)}
                                        className="px-6 py-2 bg-gray-600 text-white rounded hover:bg-gray-700"
                                    >
                                        {showPreview ? 'Hide Preview' : 'Show Preview'}
                                    </button>
                                    <button
                                        type="button"
                                        onClick={handleSave}
                                        disabled={isLoading}
                                        className="px-8 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-semibold disabled:bg-gray-400 flex items-center gap-2"
                                    >
                                        {isLoading ? (
                                            <>
                                                <svg className="animate-spin h-4 w-4" viewBox="0 0 24 24">
                                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none"></circle>
                                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                </svg>
                                                Saving...
                                            </>
                                        ) : (
                                            'Save to Google Sheets'
                                        )}
                                    </button>
                                </div>

                                {/* Preview */}
                                {showPreview && (
                                    <div className="mt-8 p-6 bg-gray-50 rounded-lg border-2 border-gray-200">
                                        <h3 className="text-xl font-bold text-gray-800 mb-4">Customer Preview</h3>
                                        <div className="bg-white p-6 rounded shadow">
                                            <div className="flex items-start justify-between mb-3">
                                                <h4 className="text-lg font-semibold text-gray-900">{currentInsight.title || '[No title]'}</h4>
                                                <div className="flex gap-2">
                                                    {currentInsight.relevanceTags.map(tag => (
                                                        <span key={tag} className="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">{tag}</span>
                                                    ))}
                                                </div>
                                            </div>
                                            <div className="text-sm text-gray-500 mb-4">
                                                {currentInsight.category} → {currentInsight.section} → {currentInsight.subsection}
                                            </div>
                                            <p className="text-gray-700 mb-4">{currentInsight.summary || '[No summary]'}</p>
                                            <div className="bg-blue-50 border-l-4 border-blue-600 p-4 mb-4">
                                                <p className="font-semibold text-blue-900 mb-1">Analysis</p>
                                                <p className="text-gray-700">{currentInsight.creatorAnalysis || '[No analysis]'}</p>
                                            </div>
                                            <div className="flex gap-4 text-sm text-gray-600">
                                                {currentInsight.impactPotential && <span>Impact: <strong>{currentInsight.impactPotential}</strong></span>}
                                                {currentInsight.timeHorizon && <span>Horizon: <strong>{currentInsight.timeHorizon}</strong></span>}
                                                {currentInsight.recommendedAction && <span>Action: <strong>{currentInsight.recommendedAction}</strong></span>}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        ) : (
                            // List View
                            <div className="bg-white rounded-lg shadow-lg p-8">
                                <h2 className="text-2xl font-bold text-gray-800 mb-6">Saved Insights ({insights.length})</h2>
                                {insights.length === 0 ? (
                                    <p className="text-gray-500 text-center py-12">No insights in Google Sheets yet. Add your first insight to get started!</p>
                                ) : (
                                    <div className="space-y-4">
                                        {insights.map(insight => (
                                            <div key={insight.id} className="border rounded-lg p-4 hover:shadow-md transition-shadow">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div className="flex-1">
                                                        <h3 className="text-lg font-semibold text-gray-900">{insight.title}</h3>
                                                        <p className="text-sm text-gray-500">{insight.category} → {insight.section}</p>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <span className={`px-3 py-1 rounded text-sm ${
                                                            insight.status === 'Published' ? 'bg-green-100 text-green-800' :
                                                            insight.status === 'Review' ? 'bg-yellow-100 text-yellow-800' :
                                                            insight.status === 'Draft' ? 'bg-gray-100 text-gray-800' :
                                                            'bg-red-100 text-red-800'
                                                        }`}>
                                                            {insight.status}
                                                        </span>
                                                        <button
                                                            type="button"
                                                            onClick={() => handleDelete(insight.id)}
                                                            disabled={isLoading}
                                                            className="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700 disabled:bg-gray-400"
                                                        >
                                                            Delete
                                                        </button>
                                                    </div>
                                                </div>
                                                <p className="text-gray-600 text-sm mb-2">{insight.summary.substring(0, 200)}...</p>
                                                <div className="flex gap-4 text-xs text-gray-500">
                                                    <span>{insight.date}</span>
                                                    <span>{insight.sourceName}</span>
                                                    {insight.relevanceTags.map(tag => (
                                                        <span key={tag} className="px-2 py-0.5 bg-blue-100 text-blue-700 rounded">{tag}</span>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<AIInsightsCreator />, document.getElementById('root'));
    </script>
</body>
</html>
